env {
  engine = "flinkStream"
  execution.checkpoint.interval = 10000
  execution.checkpoint.data-uri = "hdfs://localhost:9000/checkpoint"
}

source {

//  1 {
//    type = io.github.interestinglab.waterdrop.flilnk.source.KafkaTableStream
//    consumer.bootstrap.servers = "127.0.0.1:9092"
//    consumer.group.id = "waterdrop5"
//    consumer.key.deserializer = org.apache.kafka.common.serialization.StringDeserializer
//    consumer.value.deserializer = org.apache.kafka.common.serialization.StringDeserializer
//    consumer.enable.auto.commit = "false"
//    topics = test
//    result_table_name = test
//    source_format = csv
//    //  schema = "{\"search_time\":1553650604,\"code\":200,\"results\":{\"id\":\"449\",\"items\":[{\"id\":\"47\",\"name\":\"name47\",\"title\":\"标题47\",\"url\":\"https://www.google.com.hk/item-47\",\"publish_time\":1552884870,\"score\":96.03},{\"id\":\"2\",\"name\":\"name2\",\"title\":\"标题2\",\"url\":\"https://www.google.com.hk/item-2\",\"publish_time\":1552978902,\"score\":16.06}]}}"
//    schema = "[{\"field\":\"name\",\"type\":\"string\"},{\"field\":\"age\",\"type\":\"int\"}]"
//    format.field-delimiter = ","
//    format.line-delimiter = "\n"
//    format.quote-character = "'"
//    format.allow-comments = "true"
//    format.ignore-parse-errors = "true"
//  }

  FakeSourceStream {
    result_table_name = "fake"
    field_name = "name,age"
  }

}
transform {
  Sql {
      result_table_name = "fake_1"
      //    sql = "select cast(tumble_end(wtime,interval '5' second) as VARCHAR),message,count(*) total from test group by message,tumble(wtime,interval '5' second)"
      //  sql = "select message,cast(wtime as VARCHAR)  from test"
      sql = "select * from fake"
    }
  //  2 {
  //    type = io.github.interestinglab.waterdrop.flink.transform.TableToDataStream
  //    table_name = "test_1"
  //  }
//  3 {
//    type = io.github.interestinglab.waterdrop.flink.transform.DataSteamToTable
//    table_name = "test_2"
//  }
  //  4 {
  //    type = io.github.interestinglab.waterdrop.flink.stream.transform.Sql
  //    table_name = "test_3"
  //    //    sql = "select cast(tumble_end(wtime,interval '5' second) as VARCHAR),message,count(*) total from test group by message,tumble(wtime,interval '5' second)"
  //    //  sql = "select message,cast(wtime as VARCHAR)  from test"
  //    sql = "select name from test_2"
  //  }
  //  5 {
  //    type = io.github.interestinglab.waterdrop.flink.stream.transform.io.github.interestinglab.waterdrop.flink.transform.TableToDataStream
  //    table_name = "test_3"
  //  }

}

sink {
  ConsoleSink {
    source_table_name = fake_1
  }
//  2 {
//    source_table_name = fake_1
//    type = io.github.interestinglab.waterdrop.flink.sink.FileSink
//  }
  //  2 {
  //    type = io.github.interestinglab.waterdrop.flink.sink.KafkaTable
  //    producer.bootstrap.servers = "127.0.0.1:9092"
  //    producer.key.serializer = org.apache.kafka.common.serialization.ByteArraySerializer
  //    producer.value.serializer = org.apache.kafka.common.serialization.ByteArraySerializer
  //    topics = test_sink
  //    table_name = test_1
  //    sink_table_name = test_sink
  //  }

//    3 {
//      type = io.github.interestinglab.waterdrop.flink.sink.JdbcSink
//      source_table_name = fake_1
//      driver = com.mysql.jdbc.Driver
//      url = "jdbc:mysql://localhost/test"
//      username = root
//      //    password = null
//      query = "insert into xg_test(name,age) values(?,?)"
//      batch_size = 2
//    }
}



